<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ã‚·ãƒ¼ãƒ³ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500&family=Shippori+Mincho:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
    /* ã€ä¿®æ­£ç‚¹1: CSSå¤‰æ›´ã€‘æ–°index.htmlã®ãƒ†ãƒ¼ãƒã«çµ±ä¸€ */
    :root {
        --bg-color: #0f172a;       /* æ·±ã„ç´ºè‰² (èƒŒæ™¯) */
        --text-color: #e2e8f0;     /* ç™½ã«è¿‘ã„ç°è‰² (æœ¬æ–‡) */
        --accent-color: #c0a080;   /* ãã™ã‚“ã ã‚´ãƒ¼ãƒ«ãƒ‰ (å¼·èª¿ãƒ»æ ç·š) */
        --ui-bg: #1e293b;          /* ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯è‰² */
        --font-main: 'Noto Sans JP', sans-serif;
        --font-serif: 'Shippori Mincho', serif;
    }
    
    body {
      font-family: var(--font-main);
      margin: 0; 
      padding: 2rem;
      background-color: var(--bg-color); 
      color: var(--text-color); 
      overflow-y: auto; 
      min-height: 100vh;
      box-sizing: border-box;
    }
    h1 {
      color: var(--accent-color); 
      font-family: var(--font-serif);
      border-bottom: 1px solid #444; 
      padding-bottom: 10px; 
      margin-top: 0;
      text-align: center;
    }
    h2 {
      color: var(--accent-color); 
      font-family: var(--font-serif);
      border-bottom: 1px solid #444; 
      padding-bottom: 8px;
      margin-top: 0;
      font-size: 1.2rem;
    }
    .container {
        max-width: 700px;
        margin: 0 auto; /* ä¸­å¤®å¯„ã› */
    }
    section {
      background: var(--ui-bg); 
      border: 1px solid var(--accent-color); 
      border-radius: 8px; 
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); 
    }
    textarea, input[type="number"] {
      width: 100%;
      font-size: 1rem;
      padding: 10px; 
      margin: 5px 0 15px; 
      border: 1px solid #475569; 
      border-radius: 4px; 
      background: #0f172a; 
      color: #fff; 
      box-sizing: border-box;
      font-family: var(--font-main);
    }
    textarea:focus, input[type="number"]:focus { 
        outline: none; 
        border-color: var(--accent-color); 
    }

    /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
    button {
        font-family: var(--font-main);
        font-weight: bold;
        border: none; 
        padding: 12px;
        border-radius: 4px; 
        cursor: pointer; 
        transition: opacity 0.2s;
        margin-bottom: 0.5rem; 
    }
    
    /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼‰ */
    .action-btn { 
      background: var(--accent-color); 
      color: #0f172a; 
      width: 100%; 
      display: block; 
    }
    .action-btn:hover { 
      opacity: 0.9; 
    }
    
    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ï¼‰ */
    .cancel-button { 
        background: transparent; 
        border: 1px solid #64748b; 
        color: #94a3b8; 
        width: 100%; 
        padding: 10px; 
        margin-top: 10px;
    }
    .cancel-button:hover {
        background: rgba(100, 116, 139, 0.2);
    }

    #message {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 4px; 
      white-space: pre-wrap;
      font-family: var(--font-main);
    }
    .message-success { background-color: #15803d; color: #f0fdf4; border: 1px solid #4ade80;}
    .message-error { background-color: #991b1b; color: #fee2e2; border: 1px solid #f87171;}
    .message-info { background-color: #075985; color: #e0f2f1; border: 1px solid #22d3ee;}
    </style>
</head>
<body>
    <div class="container">
        <h1>å‹‡è€…ãƒãƒ¼ãƒ¬ãƒ ï¼šæ•´å½¢ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ & JSONã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h1>

        <section>
            <h2>ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
            <input id="episode" type="number" placeholder="ä¾‹: 3" />
        </section>

        <section>
            <h2>â‘  ã‚­ãƒ£ãƒ©å£èª¿ã‚¬ã‚¤ãƒ‰ç”Ÿæˆ</h2>
            <textarea id="inputText1" placeholder="ã“ã“ã«æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
            <button onclick="copyTemplate(1)" class="action-btn">ã‚³ãƒ”ãƒ¼</button>
        </section>

        <section>
            <h2>â‘¡ è©±è€…ç‰¹å®šï¼‹å£èª¿è£œæ­£</h2>
            <textarea id="inputText2" placeholder="ã“ã“ã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å£èª¿ã‚¬ã‚¤ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
            <button onclick="copyTemplate(2)" class="action-btn">ã‚³ãƒ”ãƒ¼ï¼ˆâ‘ ã®æœ¬æ–‡ã‚’ä½¿ç”¨ï¼‰</button>
        </section>

        <section>
            <h2>â‘¢ JSONæ•´å½¢ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>
            <textarea id="inputText3" placeholder="ã“ã“ã«è©±è€…æ˜ç¤ºæ¸ˆã¿ã®æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
            <button onclick="copyTemplate(3)" class="action-btn">ã‚³ãƒ”ãƒ¼</button>
        </section>

        <section>
            <h2>â‘£ JSONãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
            <textarea id="json-input" placeholder='[{"episode": 1, "sceneNumber": 1, "character": "å‹‡è€…", "text": "...", "face": "normal"}]'></textarea>
            <button id="upload-button" class="action-btn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            <div id="message"></div>
        </section>
        
        <button id="return-button" class="cancel-button">ãƒãƒ™ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢ã«æˆ»ã‚‹</button>

        <script>
            const episodeInput = document.getElementById("episode");
            const jsonInput = document.getElementById("json-input");
            const uploadButton = document.getElementById("upload-button");
            const messageDiv = document.getElementById("message");
            const returnButton = document.getElementById("return-button"); // è¿½åŠ 
            const GAS_BASE_URL = 'https://cat-seven-blond.vercel.app/api/gas-proxy';
            const SCENES_PROXY_PATH = `${GAS_BASE_URL}?api=scenes`;

            function copyTemplate(type) {
              const ep = episodeInput.value || "1";
              const input1 = document.getElementById("inputText1").value.trim();
              const input2 = document.getElementById("inputText2").value.trim();
              const input3 = document.getElementById("inputText3").value.trim();
              let output = "";

              if (type === 1) {
                output = `ä»¥ä¸‹ã¯ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ç‰©èªã€å‹‡è€…ãƒãƒ¼ãƒ¬ãƒ ã€ã®æŠœç²‹ã§ã™ã€‚\n\nã“ã®æœ¬æ–‡ã‚’ã‚‚ã¨ã«ã€ç™»å ´ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è©±ã—æ–¹ãƒ»èªå°¾ãƒ»æ€§æ ¼ãªã©ã‚’åˆ†æã—ã€ä¸‹è¨˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\nãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ä¸€ã¤ã®è©±è€…ã¨ã—ã¦æ‰±ã£ã¦ãã ã•ã„ã€‚\n\n---\n\nã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘\nã‚­ãƒ£ãƒ©å:  \nä¸€äººç§°:  \näºŒäººç§°ï¼ˆä¸»äººå…¬ã®å‘¼ã³æ–¹ï¼‰:  \nèªå°¾ãƒ»è©±ã—æ–¹:  \næ€§æ ¼å‚¾å‘:  \nç‰¹å¾´çš„ãªå£ç™–ã‚„è¨€ã„å›ã—:  \n\n---\n\nã€å…¥åŠ›æœ¬æ–‡ã€‘\n${input1}`;
              } else if (type === 2) {
                output = `ä»¥ä¸‹ã¯ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ç‰©èªã€å‹‡è€…ãƒãƒ¼ãƒ¬ãƒ ã€ã®æœ¬æ–‡æŠœç²‹ã§ã™ã€‚\n\nã“ã®æ–‡ç« ã‚’ã‚‚ã¨ã«ã€å„è¡Œã®ã€Œè©±è€…ï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼‰ã€ã‚’è‡ªå‹•çš„ã«ç‰¹å®šã—ã€\nãã®è©±è€…ã®è©±ã—æ–¹ã‚„èªå°¾ãŒã€Œã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å£èª¿ã‚¬ã‚¤ãƒ‰ã€ã¨ä¸€è‡´ã—ã¦ã„ãªã„å ´åˆã¯è£œæ­£ã—ã¦ãã ã•ã„ã€‚\nç‰©èªã«ãµã•ã‚ã—ã„æ–‡ä½“ã«ãªã‚‹ã‚ˆã†ã€å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ€§æ ¼ã‚„çŠ¶æ³ã«å¿œã˜ãŸè‡ªç„¶ãªã‚»ãƒªãƒ•ã«è¨€ã„æ›ãˆã¦ãã ã•ã„ã€‚\nãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¡Œã‚‚ä¸‰äººç§°ã§ç°¡æ½”ãƒ»è©©çš„ã«æ•´ãˆã¦ãã ã•ã„ã€‚\n\n---\n\nã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å£èª¿ã‚¬ã‚¤ãƒ‰ã€‘\n${input2}\n\n---\n\nã€å‡ºåŠ›å½¢å¼ã€‘\nè©±è€…ï¼šã‚»ãƒªãƒ•ã¾ãŸã¯ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è£œæ­£æ¸ˆã¿æ–‡ç« \n\n---\n\n${input1}`;
              } else if (type === 3) {
                output = `ä»¥ä¸‹ã¯ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ç‰©èªã€å‹‡è€…ãƒãƒ¼ãƒ¬ãƒ ã€ã®ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰${ep}ã§ã™ã€‚\n\nã“ã®æ–‡ç« ã‚’ã‚‚ã¨ã«ã€ä»¥ä¸‹ã®æ¡ä»¶ã«å¾“ã£ã¦æ•´å½¢ã—ã¦ãã ã•ã„ã€‚\n\n---\n\n## ğŸ”¹ã€ç›®çš„ã€‘\n+\n- è¡¨æƒ…ï¼ˆæ„Ÿæƒ…ï¼‰ã‚¿ã‚°ã‚’ä»˜ä¸ï¼ˆå›ºå®šãƒ¬ãƒ‘ãƒ¼ãƒˆãƒªãƒ¼å†…ã‹ã‚‰é¸æŠï¼‰\n- å‡ºåŠ›ã‚’JSONå½¢å¼ã«æ•´å½¢ã—ã€å¾Œå‡¦ç†ã—ã‚„ã™ãã™ã‚‹\n\n---\n\n## ğŸ”¹ã€æ•´å½¢æ¡ä»¶ã€‘\n- è©±è€…ï¼ˆcharacterï¼‰ã¯å¿…ãšè¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚\n- è¡¨æƒ…ï¼ˆfaceï¼‰ã¯ã€Œè¡¨æƒ…ã‚¿ã‚°ä¸€è¦§ã€ã‹ã‚‰æœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’1ã¤é¸ã‚“ã§è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚\n\n---\n\n## ğŸ”¹ã€è¡¨æƒ…ã‚¿ã‚°ä¸€è¦§ã€‘\n\n- normalï¼ˆé€šå¸¸ï¼‰\n- smileï¼ˆç¬‘é¡”ï¼‰\n- angryï¼ˆæ€’ã‚Šï¼‰\n- shyï¼ˆæ¥ã˜ã‚‰ã„ï¼‰\n- sadï¼ˆæ‚²ã—ã¿ï¼‰\n- coldï¼ˆå†·ç¬‘ï¼‰\n- surprisedï¼ˆé©šãï¼‰\n- corruptï¼ˆå •è½ï¼‰\n- ecstasyï¼ˆææƒšï¼‰\n\nâ€»JSONå†…ã§ã¯è‹±èªè¡¨è¨˜ã§çµ±ä¸€ã—ã¦ãã ã•ã„ã€‚\n\n---\n\n## ğŸ”¹ã€å‡ºåŠ›å½¢å¼ã€‘\n\n- ä»¥ä¸‹ã®JSONæ§‹é€ ã§å‡ºåŠ›ã—ã¦ãã ã•ã„\n- background, effect, specialã¯çœç•¥å¯èƒ½ï¼ˆå¾Œå‡¦ç†ã§è¿½åŠ ï¼‰\n\n\`\`\`json\n[\n  {\n    "episode": ${ep},\n    "sceneNumber": 1,\n    "character": "ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",\n    "text": "ãƒãƒãƒ«ã¯é­”ç‹ãŒç®¡ç†ã™ã‚‹æ£®ã¸ã‚„ã£ã¦ããŸã€‚",\n    "background": "forest"\n  },\n  {\n    "episode": ${ep},\n    "sceneNumber": 2,\n    "character": "ãƒãƒãƒ«",\n    "text": "ã“ã‚Œã¯ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰1ã®æœ€åˆã®ã‚·ãƒ¼ãƒ³ã ã€‚ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆã€‚",\n    "face": "normal",\n    "background": "forest"\n  },\n  {\n    "episode": ${ep},\n    "sceneNumber": 3,\n    "character": "é­”ç‹",\n    "text": "ã»ã†ã€æ–°ãŸãªã‚·ãƒ¼ãƒ³ãŒè¿½åŠ ã•ã‚ŒãŸã‹ã€‚é¢ç™½ã„ã€‚",\n    "face": "angry",\n    "background": "forest"\n  }\n]\n\`\`\`\n\nğŸ”¹ã€æ•´å½¢å¯¾è±¡æœ¬æ–‡ã€‘\n${input3}`;
              }

              navigator.clipboard.writeText(output).then(() => {
                alert("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
              });
            }

            uploadButton.addEventListener('click', async () => {
              const jsonText = jsonInput.value.trim();
              if (!jsonText) return displayMessage('JSONãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
              displayMessage('ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ä¸­...', 'info');
              uploadButton.disabled = true;

              try {
                const jsonData = JSON.parse(jsonText);
                if (!Array.isArray(jsonData)) return displayMessage('JSONã¯é…åˆ—å½¢å¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚', 'error');
                if (jsonData.length === 0) return displayMessage('ã‚·ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ã€‚', 'info');

                const response = await fetch(SCENES_PROXY_PATH, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(jsonData),
                });

                const result = await response.json();
                if (response.ok) {
                  displayMessage(`å…¨ ${jsonData.length} ä»¶ã®ã‚·ãƒ¼ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\n${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                  let errorMessage = `ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ${response.status} ${response.statusText}\n`;
                  if (result.message) errorMessage += `è©³ç´°: ${result.message}\n`;
                  if (result.error) errorMessage += `ã‚¨ãƒ©ãƒ¼: ${result.error}\n`;
                  displayMessage(errorMessage, 'error');
                }
              } catch (error) {
                displayMessage(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, 'error');
              } finally {
                uploadButton.disabled = false;
              }
            });

            function displayMessage(message, type) {
              messageDiv.textContent = message;
              messageDiv.className = `message-${type}`;
            }

            // ã€ä¿®æ­£ç‚¹2: é·ç§»ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ã€‘ãƒãƒ™ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯
            returnButton.addEventListener('click', () => {
                // index.htmlã¯localStorageã® 'novel_viewer_save' ã‚’å‚ç…§ã—ã¦ç¶šãã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
                window.location.href = 'index.html'; 
            });
            
          </script>
    </div>
</body>
</html>
